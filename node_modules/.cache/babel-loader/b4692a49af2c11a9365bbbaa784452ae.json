{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nfunction _path() {\n  const data = _interopRequireDefault(require('path'));\n\n  _path = function _path() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _mergeStream() {\n  const data = _interopRequireDefault(require('merge-stream'));\n\n  _mergeStream = function _mergeStream() {\n    return data;\n  };\n\n  return data;\n}\n\nvar _types = require('../types');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n/* istanbul ignore next */\n\n\nconst emptyMethod = () => {};\n\nclass BaseWorkerPool {\n  constructor(workerPath, options) {\n    _defineProperty(this, '_stderr', void 0);\n\n    _defineProperty(this, '_stdout', void 0);\n\n    _defineProperty(this, '_options', void 0);\n\n    _defineProperty(this, '_workers', void 0);\n\n    this._options = options;\n    this._workers = new Array(options.numWorkers);\n\n    if (!_path().default.isAbsolute(workerPath)) {\n      workerPath = require.resolve(workerPath);\n    }\n\n    const stdout = (0, _mergeStream().default)();\n    const stderr = (0, _mergeStream().default)();\n    const forkOptions = options.forkOptions,\n          maxRetries = options.maxRetries,\n          setupArgs = options.setupArgs;\n\n    for (let i = 0; i < options.numWorkers; i++) {\n      const workerOptions = {\n        forkOptions,\n        maxRetries,\n        setupArgs,\n        workerId: i,\n        workerPath\n      };\n      const worker = this.createWorker(workerOptions);\n      const workerStdout = worker.getStdout();\n      const workerStderr = worker.getStderr();\n\n      if (workerStdout) {\n        stdout.add(workerStdout);\n      }\n\n      if (workerStderr) {\n        stderr.add(workerStderr);\n      }\n\n      this._workers[i] = worker;\n    }\n\n    this._stdout = stdout;\n    this._stderr = stderr;\n  }\n\n  getStderr() {\n    return this._stderr;\n  }\n\n  getStdout() {\n    return this._stdout;\n  }\n\n  getWorkers() {\n    return this._workers;\n  }\n\n  getWorkerById(workerId) {\n    return this._workers[workerId];\n  }\n\n  createWorker(_workerOptions) {\n    throw Error('Missing method createWorker in WorkerPool');\n  }\n\n  end() {\n    // We do not cache the request object here. If so, it would only be only\n    // processed by one of the workers, and we want them all to close.\n    for (let i = 0; i < this._workers.length; i++) {\n      this._workers[i].send([_types.CHILD_MESSAGE_END, false], emptyMethod, emptyMethod);\n    }\n  }\n\n}\n\nexports.default = BaseWorkerPool;","map":{"version":3,"sources":["/home/agatha/open/node_modules/jest-worker/build/base/BaseWorkerPool.js"],"names":["Object","defineProperty","exports","value","default","_path","data","_interopRequireDefault","require","_mergeStream","_types","obj","__esModule","_defineProperty","key","enumerable","configurable","writable","emptyMethod","BaseWorkerPool","constructor","workerPath","options","_options","_workers","Array","numWorkers","isAbsolute","resolve","stdout","stderr","forkOptions","maxRetries","setupArgs","i","workerOptions","workerId","worker","createWorker","workerStdout","getStdout","workerStderr","getStderr","add","_stdout","_stderr","getWorkers","getWorkerById","_workerOptions","Error","end","length","send","CHILD_MESSAGE_END"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nfunction _path() {\n  const data = _interopRequireDefault(require('path'));\n\n  _path = function _path() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _mergeStream() {\n  const data = _interopRequireDefault(require('merge-stream'));\n\n  _mergeStream = function _mergeStream() {\n    return data;\n  };\n\n  return data;\n}\n\nvar _types = require('../types');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\n/* istanbul ignore next */\nconst emptyMethod = () => {};\n\nclass BaseWorkerPool {\n  constructor(workerPath, options) {\n    _defineProperty(this, '_stderr', void 0);\n\n    _defineProperty(this, '_stdout', void 0);\n\n    _defineProperty(this, '_options', void 0);\n\n    _defineProperty(this, '_workers', void 0);\n\n    this._options = options;\n    this._workers = new Array(options.numWorkers);\n\n    if (!_path().default.isAbsolute(workerPath)) {\n      workerPath = require.resolve(workerPath);\n    }\n\n    const stdout = (0, _mergeStream().default)();\n    const stderr = (0, _mergeStream().default)();\n    const forkOptions = options.forkOptions,\n      maxRetries = options.maxRetries,\n      setupArgs = options.setupArgs;\n\n    for (let i = 0; i < options.numWorkers; i++) {\n      const workerOptions = {\n        forkOptions,\n        maxRetries,\n        setupArgs,\n        workerId: i,\n        workerPath\n      };\n      const worker = this.createWorker(workerOptions);\n      const workerStdout = worker.getStdout();\n      const workerStderr = worker.getStderr();\n\n      if (workerStdout) {\n        stdout.add(workerStdout);\n      }\n\n      if (workerStderr) {\n        stderr.add(workerStderr);\n      }\n\n      this._workers[i] = worker;\n    }\n\n    this._stdout = stdout;\n    this._stderr = stderr;\n  }\n\n  getStderr() {\n    return this._stderr;\n  }\n\n  getStdout() {\n    return this._stdout;\n  }\n\n  getWorkers() {\n    return this._workers;\n  }\n\n  getWorkerById(workerId) {\n    return this._workers[workerId];\n  }\n\n  createWorker(_workerOptions) {\n    throw Error('Missing method createWorker in WorkerPool');\n  }\n\n  end() {\n    // We do not cache the request object here. If so, it would only be only\n    // processed by one of the workers, and we want them all to close.\n    for (let i = 0; i < this._workers.length; i++) {\n      this._workers[i].send(\n        [_types.CHILD_MESSAGE_END, false],\n        emptyMethod,\n        emptyMethod\n      );\n    }\n  }\n}\n\nexports.default = BaseWorkerPool;\n"]},"metadata":{},"sourceType":"script"}